openapi: 3.0.3
info:
  title: Rea Prime Rest API
  version: 1.0.0
  description: |
    This API provides endpoints to retrieve a list of Bluetooth devices, trigger a scan for new devices, manage DE1 espresso machine state and settings, and interact with a connected scale.
servers:
  - url: http://{tablet-ip}:8080
    variables:
      tablet-ip:
        default: localhost

paths:
  /api/v1/devices:
    get:
      summary: Get Available Devices
      description: Retrieves a list of available devices with their connection states.
      tags: [Devices]
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    name:
                      type: string
                    id:
                      type: string
                    state:
                      type: string
                      enum: [connected, disconnected]
                    type:
                      type: string
                      enum: [machine, scale, sensor]
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /api/v1/devices/scan:
    get:
      summary: Scan for Devices
      description: Triggers a device scan.
      tags: [Devices]
      parameters:
        - name: connect
          description: whether REA should automatically connect to discovered devices while scanning (applies for scales). Default is 'false'
          in: query
          schema:
            type: boolean
        - name: quick
          description: If this flag is set to true, REA will return immediately after calling this function, returning an empty array. Useful if you want to poll for new devices manually
          in: query
          schema:
            type: boolean
      responses:
        "200":
          description: Scan started successfully
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /api/v1/devices/connect:
    put:
      summary: Connect to specified device
      description: |
        Accepts deviceId via JSON body (preferred) or query parameter (backward compatible).
        Device IDs may contain special characters (e.g. colons in BLE MAC addresses,
        slashes in serial port paths), so the JSON body approach avoids URL encoding issues.
      tags: [Devices]
      parameters:
        - name: deviceId
          description: The id of the device, previously discovered with /api/v1/devices/scan request
          in: query
          required: false
          schema:
            type: string
      requestBody:
        description: JSON object with deviceId
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                deviceId:
                  type: string
                  description: The id of the device, previously discovered with /api/v1/devices/scan request
              required:
                - deviceId
      responses:
        "200":
          description: "Device connected successfully"
        "400":
          description: "Missing deviceId"
        "404":
          description: "Device not found"

  /api/v1/devices/disconnect:
    put:
      summary: Disconnect a specified device
      description: |
        Accepts deviceId via JSON body (preferred) or query parameter (backward compatible).
      tags: [Devices]
      parameters:
        - name: deviceId
          description: The id of the device to disconnect from
          in: query
          required: false
          schema:
            type: string
      requestBody:
        description: JSON object with deviceId
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                deviceId:
                  type: string
                  description: The id of the device to disconnect from
              required:
                - deviceId
      responses:
        "200":
          description: "Device disconnected successfully"
        "400":
          description: "Missing deviceId"
        "404":
          description: "Device not found"

  # Machine specific API
  
  /api/v1/machine/info:
    get:
      summary: Retrieves the current Machine information
      tags: [Machine]
      responses:
        "200":
          description: Information about the currently connected machine or an error if not connected
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MachineInfo"

  /api/v1/machine/state:
    get:
      summary: Get Machine State
      description: Retrieves the current machine state.
      tags: [Machine]
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MachineSnapshot"
  /api/v1/machine/state/{newState}:
    put:
      summary: Request Machine State Change
      description: Requests a state change for the espresso machine.
      tags: [Machine]
      parameters:
        - name: newState
          in: path
          required: true
          schema:
            $ref: "#/components/schemas/MachineState"
      responses:
        "200":
          description: State change successful
        "400":
          description: Bad Request
  /api/v1/machine/profile:
    post:
      summary: Set Machine Profile
      description: Uploads a new brewing profile to the machine.
      tags: [Machine]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Profile"
      responses:
        "200":
          description: Profile updated successfully
  /api/v1/machine/shotSettings:
    post:
      summary: Update Shot Settings
      description: Updates shot settings on the espresso machine.
      tags: [Machine]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ShotSettings"
      responses:
        "200":
          description: Shot settings updated successfully
  /api/v1/machine/settings:
    get:
      summary: Get machine settings
      description: pulls additional settings from the machine
      tags: [Machine]
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/De1SettingsResponse"
    post:
      summary: Set machine settings
      description: set additional settings on the machine, each setting can be set individually
      tags: [Machine]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/De1SettingsRequest"
      responses:
        "200":
          description: Settings update successful

  /api/v1/machine/settings/advanced:
    get:
      summary: Get advanced machine settings
      description: Get additional advanced machine settings
      tags: [Machine]
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/De1AdvancedSettingsResponse"
    post:
      summary: Set advanced machine settings
      description: Set advanced settings on the machine, each setting can be sent separately
      tags: [Machine]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/De1AdvancedSettingsRequest"
      responses:
        "200":
          description: Advanced settings updated successfully

  /api/v1/machine/calibration:
    get:
      summary: Get machine calibration settings
      description: Returns the current flow estimation calibration multiplier from the DE1
      tags: [Machine]
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/De1CalibrationResponse"
    post:
      summary: Set machine calibration settings
      description: Updates the flow estimation calibration multiplier on the DE1
      tags: [Machine]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/De1CalibrationRequest"
      responses:
        "202":
          description: Calibration settings updated successfully

  /api/v1/machine/usb/{state}:
    put:
      summary: Toggle USB Charger Mode
      description: Enables or disables the USB charger mode on the machine.
      tags: [Machine]
      parameters:
        - name: state
          in: path
          required: true
          schema:
            type: string
            enum: [enable, disable]
      responses:
        "200":
          description: USB mode updated successfully
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /api/v1/machine/waterLevels:
    post:
      summary: Set new water level threshold, only the warningThresholdPercentage field is important here
      tags: [Machine]
      requestBody:
        required: true
        content: 
          application/json:
            schema:
              $ref: "#/components/schemas/WaterLevels"
      responses:
        "202":
          description: Levels updated

  /api/v1/machine/firmware:
    post:
      summary: Push new firmware to the machine
      description: Send a firmware file to machine, the call will wait until the firmware upgrade is complete (which might be a long time)
      tags: [Machine]
      requestBody:
        required: true
        content:
          application/octet-stream:
      responses:
        "200":
          description: Firmware update successful. Need to restart machine to load new firmware
        "500":
          description: Something went wrong during the firmware upgrade process. Check the response and Rea logs

  # Scale API
  /api/v1/scale/tare:
    put:
      summary: Tare Scale
      description: Tares the connected scale.
      tags: [Scale]
      responses:
        "200":
          description: Scale tared successfully
        "404":
          description: Scale not found

  /api/v1/scale/timer/start:
    put:
      summary: Start Scale Timer
      description: Starts the timer on the connected scale. No-op if the scale doesn't support hardware timers.
      tags: [Scale]
      responses:
        "200":
          description: Timer started
        "500":
          description: No scale connected or error

  /api/v1/scale/timer/stop:
    put:
      summary: Stop Scale Timer
      description: Stops the timer on the connected scale. No-op if the scale doesn't support hardware timers.
      tags: [Scale]
      responses:
        "200":
          description: Timer stopped
        "500":
          description: No scale connected or error

  /api/v1/scale/timer/reset:
    put:
      summary: Reset Scale Timer
      description: Resets the timer on the connected scale. No-op if the scale doesn't support hardware timers.
      tags: [Scale]
      responses:
        "200":
          description: Timer reset
        "500":
          description: No scale connected or error

  # Sensors API handling
  /api/v1/sensors:
    get:
      summary: Get a list of sensor devices connected to Rea
      description: Will show all the sensors and their ids, that are currently connected and available through Rea
      tags: [Sensors]
      responses:
        "200":
          description: List of available sensors
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    name:
                      type: string
                    info:
                      $ref: "#/components/schemas/SensorManifest"

  /api/v1/sensors/{id}:
    get:
      summary: Get full manifest for a sensor
      tags: [Sensors]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Full sensor manifest
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SensorManifest"
        "404":
          description: Sensor not found

  /api/v1/sensors/{id}/execute:
    post:
      summary: Execute a sensor command
      tags: [Sensors]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                commandId:
                  type: string
                params:
                  type: object
                  nullable: true
      responses:
        "200":
          description: Sensor executed command
          content:
            application/json:
              schema:
                type: object
                properties:
                  timestamp:
                    type: string
                  result:
                    type: object
                    nullable: true
        "404":
          description: Sensor not found

  # REA settings API
  /api/v1/settings:
    get:
      summary: Get Rea settings
      tags: [REA Settings]
      responses:
        "200":
          description: Rea settings
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ReaSettings"
    post:
      summary: Update Rea settings
      tags: [REA Settings]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ReaSettingsRequest"
      responses:
        "200":
          description: Rea settings updated successfully

  # REA Workflow API
  /api/v1/workflow:
    get:
      summary: Get current workflow
      description: |
        Retrieves the complete current workflow including profile, dose settings, grinder data, 
        coffee information, and all machine settings (steam, hot water, rinse).
        
        This is the recommended way to get all brewing parameters in a single call.
      tags: [Workflow]
      responses:
        "200":
          description: Current workflow object with all settings
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/WorkflowRequest"
    put:
      summary: Update current workflow
      description: |
        Updates the current workflow. This is the **recommended method** for applying changes 
        to the machine and brewing parameters in one atomic operation.
        
        You can update the complete workflow or just specific fields:
        - **profile**: Update the brewing profile
        - **doseData**: Change input/output dose targets
        - **grinderData**: Update grinder settings
        - **coffeeData**: Change coffee information
        - **steamSettings**: Modify steam temperature, duration, and flow
        - **hotWaterData**: Adjust hot water temperature, volume, duration, and flow
        - **rinseData**: Update rinse temperature, duration, and flow
        
        This approach is preferred over updating individual settings via separate endpoints 
        as it ensures all related settings are applied together and uploaded to the machine 
        as a cohesive recipe.
      tags: [Workflow]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/WorkflowRequest"
            examples:
              updateProfile:
                summary: Update just the profile
                value:
                  profile:
                    version: "2"
                    title: "Updated Profile"
                    steps: []
              updateDoseAndGrinder:
                summary: Update dose and grinder settings
                value:
                  doseData:
                    doseIn: 18.5
                    doseOut: 37.0
                  grinderData:
                    setting: "2.8"
                    manufacturer: "Niche"
                    model: "Zero"
              updateSteamSettings:
                summary: Update steam settings
                value:
                  steamSettings:
                    targetTemperature: 155
                    duration: 60
                    flow: 0.9
              completeWorkflow:
                summary: Complete workflow update
                value:
                  name: "Morning Espresso"
                  description: "Daily shot recipe"
                  profile:
                    version: "2"
                    title: "Classic Profile"
                    steps: []
                  doseData:
                    doseIn: 18.0
                    doseOut: 36.0
                  grinderData:
                    setting: "2.5"
                    manufacturer: "Niche"
                    model: "Zero"
                  coffeeData:
                    name: "Ethiopia Yirgacheffe"
                    roaster: "Local Roaster"
                  steamSettings:
                    targetTemperature: 150
                    duration: 50
                    flow: 0.8
                  hotWaterData:
                    targetTemperature: 75
                    duration: 30
                    volume: 50
                    flow: 10.0
                  rinseData:
                    targetTemperature: 90
                    duration: 10
                    flow: 6.0
      responses:
        "200":
          description: Returns the updated workflow object
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/WorkflowRequest"

  # REA Shot history API
  /api/v1/shots:
    get:
      summary: Get a list of shots stored by REA
      tags: [Shots History]
      parameters:
        - in: query
          name: ids
          description: identifiers of the shots, comma separated
          required: false
          schema:
            type: array
            items:
              type: string
        - in: query
          name: orderBy
          description: Field to sort results by
          required: false
          schema:
            type: string
            enum: [timestamp]
            default: timestamp
        - in: query
          name: order
          description: Sort direction
          required: false
          schema:
            type: string
            enum: [asc, desc]
            default: desc
      responses:
        "200":
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ShotRecord"
  /api/v1/shots/ids:
    get:
      summary: Get a list of identifiers of all the shots
      tags: [Shots History]
      parameters:
        - in: query
          name: orderBy
          description: Field to sort results by
          required: false
          schema:
            type: string
            enum: [timestamp]
            default: timestamp
        - in: query
          name: order
          description: Sort direction
          required: false
          schema:
            type: string
            enum: [asc, desc]
            default: desc
      responses:
        "200":
          content:
            application/json:
              schema:
                type: array
                items:
                  type: string

  /api/v1/shots/latest:
    get:
      summary: Get the latest shot details
      tags: [Shots History]
      responses:
        "200":
          content:
            application/json:
              schema: 
                $ref: "#/components/schemas/ShotRecord"

  /api/v1/shots/{id}:
    get:
      summary: Get a specific shot by ID
      tags: [Shots History]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: Shot ID
      responses:
        "200":
          description: Shot found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ShotRecord"
        "404":
          description: Shot not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
    
    put:
      summary: Update a shot record
      description: |
        Updates an existing shot record. Supports partial updates â€” only the fields
        included in the request body will be changed, all other fields are preserved
        from the existing record. Commonly used to add or update shot notes or metadata.
      tags: [Shots History]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: Shot ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ShotRecord"
            examples:
              updateNotes:
                summary: Update only shot notes
                value:
                  shotNotes: "Tasted great, slightly fruity"
              updateMetadata:
                summary: Update only metadata
                value:
                  metadata:
                    rating: 4.5
                    favorite: true
      responses:
        "200":
          description: Shot updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ShotRecord"
        "400":
          description: Bad Request (ID mismatch)
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        "404":
          description: Shot not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
    
    delete:
      summary: Delete a shot record
      description: Permanently deletes a shot record from storage
      tags: [Shots History]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: Shot ID
      responses:
        "200":
          description: Shot deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  id:
                    type: string
        "404":
          description: Shot not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string

  # REA Key-Value Store for clients
  /api/v1/store/{namespace}:
    get:
      summary: Get a list of all the keys in the specified key value namespace
      tags: [Key value store]
      parameters:
        - name: namespace
          value: default
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Array of keys
          content:
            application/json:
              schema:
                type: array
                items:
                  type: string

  /api/v1/store/{namespace}/{key}:
    get:
      summary: Get value for a key
      tags: [Key value store]
      parameters:
        - name: namespace
          value: default
          in: path
          required: true
          schema:
            type: string
        - name: key
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: JSON value stored under the key
          content:
            application/json:
              schema: {}
        "404":
          description: Key not found

    post:
      summary: Set value for a key
      tags: [Key value store]
      parameters:
        - name: namespace
          value: default
          in: path
          required: true
          schema:
            type: string
        - name: key
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema: {}
      responses:
        "204":
          description: Successfully stored

    delete:
      summary: Delete key
      tags: [Key value store]
      parameters:
        - name: namespace
          value: default
          in: path
          required: true
          schema:
            type: string
        - name: key
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Key deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  deleted:
                    type: boolean
        "404":
          description: Key not found

  /api/v1/plugins:
    get:
      summary: List all currently loaded plugins
      tags: [Plugins]
      responses:
        "200":
          description: A list of all the currently loaded plugin manifests
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PluginManifest'

  /api/v1/plugins/{id}/settings:
    get:
      tags: [Plugins]
      summary: Fetch settings for specific plugin
      parameters:
        - name: id
          in: path
          description: the plugin id
      responses:
        "200":
          content:
            application/json:
              schema:
                type: object

    post:
      tags: [Plugins]
      summary: Save settings for specific plugin
      parameters:
        - name: id
          in: path
          description: the plugin id
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        "200":
          content:
            application/json:
              schema:
                type: object

  # Profiles API
  # 
  # REA uses content-based hashing for profile identification:
  # - Profile Hash (ID): Calculated from execution-relevant fields (beverage_type, steps, tank_temperature, 
  #   target_weight, target_volume, target_volume_count_start, legacy_profile_type, type, version)
  # - Metadata Hash: Calculated from presentation fields (title, author, notes)
  # - Compound Hash: Combined hash of both, used for full change detection
  #
  # Benefits:
  # - Automatic deduplication: Identical profiles have identical IDs across all devices
  # - Cloud sync friendly: No ID conflicts when syncing between devices
  # - Version tracking: Changes to execution fields create new profile IDs
  #
  /api/v1/profiles:
    get:
      summary: Get all profiles
      description: Retrieves all profiles, optionally filtered by visibility or parent ID
      tags: [Profiles]
      parameters:
        - name: visibility
          in: query
          required: false
          schema:
            type: string
            enum: [visible, hidden, deleted]
          description: Filter profiles by visibility state
        - name: includeHidden
          in: query
          required: false
          schema:
            type: boolean
            default: false
          description: Include hidden profiles in results
        - name: parentId
          in: query
          required: false
          schema:
            type: string
          description: Filter profiles by parent ID (for version tracking)
      responses:
        "200":
          description: Array of profile records
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ProfileRecord'
        "400":
          description: Bad Request (invalid visibility value)
        "500":
          description: Internal Server Error
    
    post:
      summary: Create new profile
      description: Creates a new profile record with optional parent reference
      tags: [Profiles]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - profile
              properties:
                profile:
                  $ref: '#/components/schemas/Profile'
                parentId:
                  type: string
                  nullable: true
                  description: ID of parent profile (for versioning)
                metadata:
                  type: object
                  nullable: true
                  description: Additional metadata
      responses:
        "201":
          description: Profile created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProfileRecord'
        "400":
          description: Bad Request (missing required fields or invalid parent ID)
        "500":
          description: Internal Server Error

  /api/v1/profiles/{id}:
    get:
      summary: Get profile by ID
      description: Retrieves a single profile record by its ID
      tags: [Profiles]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Profile ID
      responses:
        "200":
          description: Profile found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProfileRecord'
        "404":
          description: Profile not found
        "500":
          description: Internal Server Error
    
    put:
      summary: Update profile
      description: Updates an existing profile. Cannot modify default profiles' content, only metadata.
      tags: [Profiles]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Profile ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                profile:
                  $ref: '#/components/schemas/Profile'
                  nullable: true
                metadata:
                  type: object
                  nullable: true
      responses:
        "200":
          description: Profile updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProfileRecord'
        "400":
          description: Bad Request (profile not found or cannot modify default profile)
        "500":
          description: Internal Server Error
    
    delete:
      summary: Delete profile
      description: Soft deletes a user profile or hides a default profile
      tags: [Profiles]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Profile ID
      responses:
        "200":
          description: Profile deleted/hidden successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  id:
                    type: string
        "404":
          description: Profile not found
        "500":
          description: Internal Server Error

  /api/v1/profiles/{id}/visibility:
    put:
      summary: Change profile visibility
      description: Changes the visibility state of a profile (visible, hidden, deleted)
      tags: [Profiles]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Profile ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - visibility
              properties:
                visibility:
                  type: string
                  enum: [visible, hidden, deleted]
                  description: New visibility state
      responses:
        "200":
          description: Visibility changed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProfileRecord'
        "400":
          description: Bad Request (invalid visibility or cannot delete default profile)
        "404":
          description: Profile not found
        "500":
          description: Internal Server Error

  /api/v1/profiles/{id}/lineage:
    get:
      summary: Get profile lineage
      description: Retrieves the full version history/lineage of a profile (parents and children)
      tags: [Profiles]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Profile ID
      responses:
        "200":
          description: Profile lineage retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ProfileRecord'
        "404":
          description: Profile not found
        "500":
          description: Internal Server Error

  /api/v1/profiles/{id}/purge:
    delete:
      summary: Permanently delete profile
      description: Permanently removes a profile from storage. Cannot purge default profiles. Use with caution.
      tags: [Profiles]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Profile ID
      responses:
        "200":
          description: Profile permanently deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  id:
                    type: string
        "400":
          description: Bad Request (cannot purge default profiles)
        "404":
          description: Profile not found
        "500":
          description: Internal Server Error

  /api/v1/profiles/import:
    post:
      summary: Import profiles
      description: Batch import profiles from JSON array (e.g., from backup)
      tags: [Profiles]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/ProfileRecord'
      responses:
        "200":
          description: Import completed
          content:
            application/json:
              schema:
                type: object
                properties:
                  imported:
                    type: integer
                    description: Number of profiles successfully imported
                  skipped:
                    type: integer
                    description: Number of profiles skipped (already exist)
                  failed:
                    type: integer
                    description: Number of profiles that failed to import
                  errors:
                    type: array
                    items:
                      type: string
                    description: Error messages for failed imports
        "500":
          description: Internal Server Error

  /api/v1/profiles/export:
    get:
      summary: Export profiles
      description: Exports all profiles as JSON array for backup
      tags: [Profiles]
      parameters:
        - name: includeHidden
          in: query
          required: false
          schema:
            type: boolean
            default: false
          description: Include hidden profiles in export
        - name: includeDeleted
          in: query
          required: false
          schema:
            type: boolean
            default: false
          description: Include deleted profiles in export
      responses:
        "200":
          description: Profiles exported successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ProfileRecord'
          headers:
            Content-Disposition:
              schema:
                type: string
              description: 'attachment; filename="profiles_export.json"'
        "500":
          description: Internal Server Error

  /api/v1/profiles/restore/{filename}:
    post:
      summary: Restore default profile
      description: Restores a bundled default profile from assets by filename
      tags: [Profiles]
      parameters:
        - name: filename
          in: path
          required: true
          schema:
            type: string
          description: Filename of the default profile in assets
      responses:
        "200":
          description: Default profile restored successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProfileRecord'
        "404":
          description: Default profile not found
        "500":
          description: Internal Server Error

  /api/v1/webui/skins:
    get:
      summary: List all installed WebUI skins
      description: Returns a list of all installed WebUI skins with their metadata
      tags: [WebUI]
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/WebUISkin'
        "500":
          description: Internal Server Error

  /api/v1/webui/skins/{id}:
    get:
      summary: Get specific WebUI skin details
      description: Returns details for a specific WebUI skin by ID
      tags: [WebUI]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Skin ID
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WebUISkin'
        "404":
          description: Skin not found
        "500":
          description: Internal Server Error
    delete:
      summary: Remove/uninstall a WebUI skin
      description: Removes a user-installed WebUI skin (bundled skins cannot be removed)
      tags: [WebUI]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Skin ID
      responses:
        "200":
          description: Skin removed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  id:
                    type: string
        "403":
          description: Cannot remove bundled skin
        "404":
          description: Skin not found
        "500":
          description: Internal Server Error

  /api/v1/webui/skins/default:
    get:
      summary: Get the default WebUI skin
      description: Returns the default skin based on user preference (defaults to 'streamline-project')
      tags: [WebUI]
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WebUISkin'
        "404":
          description: No default skin available
        "500":
          description: Internal Server Error
    put:
      summary: Set the default WebUI skin
      description: Sets the user's preferred default skin by ID and persists to preferences
      tags: [WebUI]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - skinId
              properties:
                skinId:
                  type: string
                  description: ID of the skin to set as default
                  example: "my-nextjs-skin"
      responses:
        "200":
          description: Default skin updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  skinId:
                    type: string
        "400":
          description: Bad request (missing skinId field)
        "404":
          description: Skin not found
        "500":
          description: Internal Server Error

  /api/v1/webui/skins/install/github-release:
    post:
      summary: Install skin from GitHub Release
      description: Downloads and installs a WebUI skin from a GitHub Release using the GitHub API
      tags: [WebUI]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - repo
              properties:
                repo:
                  type: string
                  description: GitHub repository in format "owner/repo"
                  example: "username/my-skin-repo"
                asset:
                  type: string
                  description: Optional specific asset name to download (e.g., "my-skin.zip"). If not provided, downloads first .zip asset
                  example: "my-skin.zip"
                prerelease:
                  type: boolean
                  description: Whether to include pre-release versions
                  default: false
      responses:
        "200":
          description: Skin installed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  repo:
                    type: string
        "400":
          description: Bad request (missing repo field)
        "500":
          description: Internal Server Error

  /api/v1/webui/skins/install/github-branch:
    post:
      summary: Install skin from GitHub branch
      description: Downloads and installs a WebUI skin from a GitHub branch archive
      tags: [WebUI]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - repo
              properties:
                repo:
                  type: string
                  description: GitHub repository in format "owner/repo"
                  example: "username/my-skin-repo"
                branch:
                  type: string
                  description: Branch name to download from
                  default: "main"
                  example: "main"
      responses:
        "200":
          description: Skin installed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  repo:
                    type: string
                  branch:
                    type: string
        "400":
          description: Bad request (missing repo field)
        "500":
          description: Internal Server Error

  /api/v1/webui/skins/install/url:
    post:
      summary: Install skin from URL
      description: Downloads and installs a WebUI skin from a direct ZIP URL
      tags: [WebUI]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - url
              properties:
                url:
                  type: string
                  format: uri
                  description: Direct URL to a .zip file containing the skin
                  example: "https://example.com/skin.zip"
      responses:
        "200":
          description: Skin installed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  url:
                    type: string
        "400":
          description: Bad request (missing url field)
        "500":
          description: Internal Server Error

components:
  schemas:
    Error:
      type: object
      properties:
        e:
          type: string
        st:
          type: string

    MachineInfo:
      type: object
      properties:
        version:
          type: string
          description: Machine Firmware version
        model:
          type: string
          description: Machine Model name
        serialNumber:
          type: string
          description: Machine serial number
        GHC:
          type: boolean
          description: Whether GroupHeadController is present and active
        extra:
          type: object
          description: various extra information

    ScaleSnapshot:
      type: object
      properties:
        timestamp:
          type: string
          format: date-time
        weight:
          type: number
        batteryLevel:
          type: integer
        timerValue:
          type: integer
          nullable: true
          description: Timer elapsed time in milliseconds. Null if scale doesn't support timers or timer hasn't been started.
    MachineSnapshot:
      type: object
      properties:
        timestamp:
          type: string
          format: date-time
        state:
          type: object
          properties:
            state:
              $ref: "#/components/schemas/MachineState"
            substate:
              $ref: "#/components/schemas/MachineSubstate"
        flow:
          type: number
        pressure:
          type: number
          example: 6.2
        targetFlow:
          type: number
        targetPressure:
          type: number
        mixTemperature:
          type: number
        groupTemperature:
          type: number
        targetMixTemperature:
          type: number
        targetGroupTemperature:
          type: number
        profileFrame:
          type: integer
        steamTemperature:
          type: number
    MachineState:
      type: string
      enum:
        [
          booting,
          busy,
          idle,
          sleeping,
          heating,
          preheating,
          espresso,
          hotWater,
          flush,
          steam,
          steamRinse,
          skipStep,
          cleaning,
          descaling,
          calibration,
          selfTest,
          airPurge,
          needsWater,
          error,
          fwUpgrade,
        ]
      example: espresso
    MachineSubstate:
      type: string
      enum:
        [
          idle,
          preparingForShot,
          preinfusion,
          pouring,
          pouringDone,
          cleaningStart,
          cleaingGroup,
          cleanSoaking,
          cleaningSteam,
          errorNaN,
          errorInf,
          errorGeneric,
          errorAcc,
          errorTSensor,
          errorPSensor,
          errorWLevel,
          errorDip,
          errorAssertion,
          errorUnsafe,
          errorInvalidParam,
          errorFlash,
          errorOOM,
          errorDeadline,
          errorHiCurrent,
          errorLoCurrent,
          errorBootFill,
          errorNoAC,

        ]
      example: preparingForShot
    Profile:
      type: object
      properties:
        version:
          type: string
        title:
          type: string
        notes:
          type: string
        author:
          type: string
        beverage_type:
          type: string
        steps:
          type: array
          items:
            type: object
        target_volume:
          type: number
        target_weight:
          type: number
        target_volume_count_start:
          type: integer
        tank_temperature:
          type: number
    ShotSettings:
      type: object
      properties:
        steamSetting:
          type: integer
          nullable: false
        targetSteamTemp:
          type: integer
          nullable: false
        targetSteamDuration:
          type: integer
          nullable: false
        targetHotWaterTemp:
          type: integer
          nullable: false
        targetHotWaterVolume:
          type: integer
          nullable: false
        targetHotWaterDuration:
          type: integer
          nullable: false
        targetShotVolume:
          type: integer
          nullable: false
        groupTemp:
          type: number
          nullable: false
    WaterLevels:
      type: object
      properties:
        currentLevel:
          type: integer
          description: Water height in the tank (mm)
        refillLevel:
          type: integer
    De1SettingsRequest:
      type: object
      properties:
        usb:
          type: boolean
          nullable: true
        fan:
          type: integer
          nullable: true
        flushTemp:
          type: integer
          nullable: true
        flushFlow:
          type: number
          nullable: true
        flushTimeout:
          type: integer
          nullable: true
        hotWaterFlow:
          type: number
          nullable: true
        steamFlow:
          type: number
          nullable: true
        tankTemp:
          type: integer
          nullable: true
    De1SettingsResponse:
      type: object
      properties:
        usb:
          type: boolean
        fan:
          type: integer
        flushTemp:
          type: integer
        flushFlow:
          type: number
        flushTimeout:
          type: integer
        hotWaterFlow:
          type: number
        steamFlow:
          type: number
        tankTemp:
          type: integer
    De1AdvancedSettingsRequest:
      type: object
      properties:
        heaterPh1Flow:
          description: Heater phase 1 flow (when heating up for shot)
          type: number
          nullable: true
        heaterPh2Flow:
          description: Heater phase 2 flow (when heating up for shot)
          type: number
          nullable: true
        heaterIdleTemp:
          description: Heater idle temperature
          type: number
          nullable: true
        heaterPh2Timeout:
          description: Heater phase 2 timeout in seconds (how long should de1 try to stabilize temperature)
          type: integer
          nullable: true
    De1AdvancedSettingsResponse:
      type: object
      properties:
        heaterPh1Flow:
          description: Heater phase 1 flow (when heating up for shot)
          type: number
        heaterPh2Flow:
          description: Heater phase 2 flow (when heating up for shot)
          type: number
        heaterIdleTemp:
          description: Heater idle temperature
          type: number
        heaterPh2Timeout:
          description: Heater phase 2 timeout in seconds (how long should de1 try to stabilize temperature)
          type: integer
    De1CalibrationRequest:
      type: object
      properties:
        flowMultiplier:
          description: Flow estimation calibration multiplier (valid range 0.13â€“2.0)
          type: number
          format: double
          nullable: true
          minimum: 0.13
          maximum: 2.0
          example: 1.0
    De1CalibrationResponse:
      type: object
      properties:
        flowMultiplier:
          description: Flow estimation calibration multiplier (valid range 0.13â€“2.0)
          type: number
          format: double
          example: 1.0
    De1RawMessage:
      type: object
      required:
        - type
        - operation
        - characteristicUUID
        - payload
      properties:
        type:
          $ref: "#/components/schemas/De1RawMessageType"
        operation:
          $ref: "#/components/schemas/De1RawOperationType"
        characteristicUUID:
          type: string
          description: UUID of the characteristic (len = 4).
        payload:
          type: string
          description: The data payload as a hex string.

    De1RawMessageType:
      type: string
      enum:
        - request
        - response
      description: Type of raw message indicating whether it's a request or response.

    De1RawOperationType:
      type: string
      enum:
        - read
        - write
        - notify
      description: Operation type indicating the nature of the raw message.

    ReaSettingsRequest:
      type: object
      properties:
        gatewayMode:
          description: Control whether Rea acts as gateway. Disabled means gateway is disabled, full means full gateway mode. Tracking means rea will not show graphs, but will control the shot (stop at weight)
          type: string
          enum: ["disabled", "full", "tracking"]
          nullable: true
        webUiPath:
          description: Set a path on local filesystem, from which REA will serve the webUI
          type: string
          nullable: true
        logLevel:
          description: Current REA log level
          type: string
          enum: [ALL,FINEST,FINER,FINE,CONFIG,INFO,WARNING,SEVERE,SHOUT,OFF]
          nullable: true
        weightFlowMultiplier:
          description: Multiplier factor applied to weight flow for projected weight calculation when stopping shots by weight. Default is 1.0. Higher values stop the shot earlier, lower values stop later.
          type: number
          format: double
          nullable: true
          example: 1.0
        volumeFlowMultiplier:
          description: Multiplier factor (in seconds) applied to machine flow for projected volume calculation when stopping shots by volume. Default is 0.3. This accounts for system lag between stop command and actual flow stop.
          type: number
          format: double
          nullable: true
          example: 0.3
        scalePowerMode:
          description: Automatic scale power management tied to machine state. Disabled means no automatic action. displayOff turns off scale display when machine sleeps (scales without display control will disconnect). disconnect disconnects scale completely when machine sleeps.
          type: string
          enum: ["disabled", "displayOff", "disconnect"]
          nullable: true
          example: "disabled"
        preferredMachineId:
          description: Device ID of the preferred machine for auto-connect on startup. When set, REA will automatically connect to this machine when it's discovered during device scan. Set to null to clear the preference.
          type: string
          nullable: true
          example: "F4:12:FA:5C:3D:8E"

    ReaSettings:
      type: object
      properties:
        gatewayMode:
          description: Control whether Rea acts as gateway. Disabled means gateway is disabled, full means full gateway mode. Tracking means rea will not show graphs, but will control the shot (stop at weight)
          type: string
          enum: ["disabled", "full", "tracking"]
        webUiPath:
          description: Path of the currently served folder on the filesystem, if enabled
          type: string
        logLevel:
          description: Current REA log level
          type: string
          enum: [ALL,FINEST,FINER,FINE,CONFIG,INFO,WARNING,SEVERE,SHOUT,OFF]
        weightFlowMultiplier:
          description: Multiplier factor applied to weight flow for projected weight calculation when stopping shots by weight. Default is 1.0. Higher values stop the shot earlier, lower values stop later.
          type: number
          format: double
          example: 1.0
        volumeFlowMultiplier:
          description: Multiplier factor (in seconds) applied to machine flow for projected volume calculation when stopping shots by volume. Default is 0.3. This accounts for system lag between stop command and actual flow stop.
          type: number
          format: double
          example: 0.3
        scalePowerMode:
          description: Automatic scale power management tied to machine state. Disabled means no automatic action. displayOff turns off scale display when machine sleeps (scales without display control will disconnect). disconnect disconnects scale completely when machine sleeps.
          type: string
          enum: ["disabled", "displayOff", "disconnect"]
          example: "disabled"
        preferredMachineId:
          description: Device ID of the preferred machine for auto-connect on startup. Returns null if no preferred device is set.
          type: string
          nullable: true
          example: "F4:12:FA:5C:3D:8E"

    SensorManifest:
      type: object
      required:
        - id
        - dataChannels
      properties:
        id:
          type: string
          description: Unique sensor ID
          example: "sensor:acme:tempflow:001"
        name:
          type: string
          example: "Acme Temp+Flow v1"
        vendor:
          type: string
          example: "Acme"
        dataChannels:
          type: array
          items:
            $ref: "#/components/schemas/DataChannel"
        commands:
          type: array
          items:
            $ref: "#/components/schemas/CommandDescriptor"

    DataChannel:
      type: object
      required:
        - key
        - type
      properties:
        key:
          type: string
          example: "temperature"
        type:
          type: string
          enum: ["number", "integer", "string", "boolean", "object", "array"]
          example: "number"
        unit:
          type: string
          example: "Â°C"

    CommandDescriptor:
      type: object
      required:
        - id
      properties:
        id:
          type: string
          example: "calibrate"
        name:
          nullable: true
          type: string
          example: "Calibrate sensor"
        description:
          nullable: true
          type: string
          example: "Run auto-calibration routine."
        paramsSchema:
          type: object
          additionalProperties: true
          example:
            type: object
            properties:
              mode:
                type: string
                enum: ["quick", "full"]
            required: ["mode"]
        resultSchema:
          type: object
          additionalProperties: true
          example:
            type: object
            properties:
              success:
                type: boolean
              message:
                type: string

    SensorSnapshot:
      type: object
      required:
        - values

    WorkflowRequest:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        profile:
          $ref: "#/components/schemas/Profile"
        doseData:
          $ref: "#/components/schemas/DoseData"
        grinderData:
          $ref: "#/components/schemas/GrinderData"
        coffeeData:
          $ref: "#/components/schemas/CoffeeData"
        steamSettings:
          $ref: "#/components/schemas/SteamSettings"
        hotWaterData:
          $ref: "#/components/schemas/HotWaterData"
        rinseData:
          $ref: "#/components/schemas/RinseData"

    DoseData:
      type: object
      required:
        - doseIn
        - doseOut
      properties:
        doseIn:
          type: number
          description: Input dose (dry coffee weight in grams)
          example: 18.0
        doseOut:
          type: number
          description: Target output dose (beverage weight in grams)
          example: 36.0

    GrinderData:
      type: object
      required:
        - setting
      properties:
        setting:
          type: string
          description: Grinder setting (e.g., "2.5", "15")
          example: "2.5"
        manufacturer:
          type: string
          nullable: true
          description: Grinder manufacturer name
          example: "Niche"
        model:
          type: string
          nullable: true
          description: Grinder model name
          example: "Zero"

    CoffeeData:
      type: object
      required:
        - name
      properties:
        name:
          type: string
          description: Coffee name or variety
          example: "Ethiopia Yirgacheffe"
        roaster:
          type: string
          nullable: true
          description: Roaster name
          example: "Local Roaster"

    SteamSettings:
      type: object
      required:
        - targetTemperature
        - duration
        - flow
      properties:
        targetTemperature:
          type: integer
          description: Target steam temperature in Celsius
          example: 150
        duration:
          type: integer
          description: Steam duration in seconds
          example: 50
        flow:
          type: number
          format: double
          description: Steam flow rate
          example: 0.8

    HotWaterData:
      type: object
      required:
        - targetTemperature
        - duration
        - volume
        - flow
      properties:
        targetTemperature:
          type: integer
          description: Target hot water temperature in Celsius
          example: 75
        duration:
          type: integer
          description: Hot water dispensing duration in seconds
          example: 30
        volume:
          type: integer
          description: Target hot water volume in milliliters
          example: 50
        flow:
          type: number
          format: double
          description: Hot water flow rate
          example: 10.0

    RinseData:
      type: object
      required:
        - targetTemperature
        - duration
        - flow
      properties:
        targetTemperature:
          type: integer
          description: Target rinse water temperature in Celsius
          example: 90
        duration:
          type: integer
          description: Rinse duration in seconds
          example: 10
        flow:
          type: number
          format: double
          description: Rinse flow rate
          example: 6.0

    ShotRecord:
      type: object
      properties:
        id:
          type: string
        timestamp:
          type: string
        measurements:
          type: array
          items:
            $ref: "#/components/schemas/ShotSnapshot"
        workflow:
          $ref: "#/components/schemas/WorkflowRequest"
        shotNotes:
          type: string
          nullable: true
          description: Optional notes about the shot (e.g., tasting notes, observations)
        metadata:
          type: object
          nullable: true
          additionalProperties: true
          description: |
            Optional flexible metadata dictionary for future extensibility.
            Can store arbitrary key-value pairs such as:
            - rating: numerical rating (1-5)
            - tags: array of strings for categorization
            - favorite: boolean flag
            - barista: string name
            - customFields: any application-specific data
          example:
            rating: 4.5
            tags: ["morning", "sweet"]
            favorite: true
            barista: "Alice"

    ShotSnapshot:
      type: object
      properties:
        machine:
          $ref: "#/components/schemas/MachineSnapshot"
        scale:
          $ref: "#/components/schemas/WeightSnapshot"
        volume:
          type: number
          format: double
          nullable: true
          description: Accumulated volume in milliliters (ml) since shot start, calculated by integrating machine flow over time. Only counted from profile frame specified in targetVolumeCountStart.

    WeightSnapshot:
      type: object
      properties:
        timestamp:
          type: string
          format: date-time
        weight:
          type: number
        weightFlow:
          type: number
        batteryLevel:
          type: integer

    PluginManifest:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        author:
          type: string
        description:
          type: string
        version:
          type: string
        apiVersion:
          type: string
        permissions:
          type: string
          enum: [log, emit, pluginStorage]
        settings:
          description: Plugin settings schema
          type: object
        api:
          type: array
          description: A list of endpoints this plugin will expose
          items:
            type: object
            properties:
              id:
                type: string
              type:
                type: string
                enum: ['websocket']
              data:
                type: object

    ProfileRecord:
      type: object
      required:
        - id
        - profile
        - metadataHash
        - compoundHash
        - visibility
        - isDefault
        - createdAt
        - updatedAt
      properties:
        id:
          type: string
          description: Content-based hash ID (profile hash) calculated from execution-relevant fields. Format 'profile:<20_hex_chars>'. Identical profile content produces identical IDs across all devices, enabling automatic deduplication.
          example: "profile:a1b2c3d4e5f6g7h8"
        profile:
          $ref: '#/components/schemas/Profile'
          description: The actual profile data
        metadataHash:
          type: string
          description: SHA-256 hash of metadata fields (title, author, notes). Used to detect presentation-only changes.
          example: "3f4e5d6c7b8a9..."
        compoundHash:
          type: string
          description: Combined hash of profile hash + metadata hash. Changes whenever any field changes, used for full change detection.
          example: "9a8b7c6d5e4f3..."
        parentId:
          type: string
          nullable: true
          description: ID (profile hash) of the parent profile for version tracking
          example: "profile:9z8y7x6w5v4u3t2"
        visibility:
          $ref: '#/components/schemas/Visibility'
          description: Current visibility state of the profile
        isDefault:
          type: boolean
          description: Whether this is a bundled default profile (cannot be permanently deleted)
        createdAt:
          type: string
          format: date-time
          description: Timestamp when the profile was created
        updatedAt:
          type: string
          format: date-time
          description: Timestamp when the profile was last updated
        metadata:
          type: object
          nullable: true
          description: Additional metadata for the profile (e.g., tags, categories)
          additionalProperties: true

    Visibility:
      type: string
      enum: [visible, hidden, deleted]
      description: Visibility state of a profile. 'visible' = shown in UI, 'hidden' = hidden from UI but not deleted, 'deleted' = soft-deleted (user profiles only)

    WebUISkin:
      type: object
      required:
        - id
        - name
        - path
        - isBundled
      properties:
        id:
          type: string
          description: Unique skin identifier (from manifest.json or directory name)
          example: "my-nextjs-skin"
        name:
          type: string
          description: Human-readable skin name
          example: "Beautiful Espresso UI"
        path:
          type: string
          description: Filesystem path to the skin directory
          example: "/path/to/app/documents/web-ui/my-skin-id"
        description:
          type: string
          nullable: true
          description: Skin description
          example: "Modern Next.js skin with real-time visualization"
        version:
          type: string
          nullable: true
          description: Skin version
          example: "1.2.0"
        isBundled:
          type: boolean
          description: Whether this is a bundled skin (cannot be removed)
        reaMetadata:
          $ref: '#/components/schemas/WebUIReaMetadata'
          nullable: true
          description: REA tracking metadata for the skin

    WebUIReaMetadata:
      type: object
      required:
        - skinId
        - installedAt
      properties:
        skinId:
          type: string
          description: Skin identifier
        sourceUrl:
          type: string
          nullable: true
          description: Source URL or identifier (e.g., 'github_release:owner/repo@v1.0.0')
        lastModified:
          type: string
          nullable: true
          description: HTTP Last-Modified header from source
        etag:
          type: string
          nullable: true
          description: HTTP ETag header from source
        commitHash:
          type: string
          nullable: true
          description: Git commit hash or release tag
        installedAt:
          type: string
          format: date-time
          description: When the skin was installed
        lastChecked:
          type: string
          format: date-time
          nullable: true
          description: When updates were last checked





