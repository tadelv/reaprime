# Requirements Archive: v1.0 ReaPrime Field Telemetry

**Archived:** 2026-02-16
**Status:** SHIPPED
**Coverage:** 22/25 fully satisfied, 3 partial (functionally covered)

---

# Requirements: ReaPrime Field Telemetry

**Defined:** 2026-02-15
**Core Value:** Reliable, anonymized field telemetry from mission-critical device communication paths so we can diagnose connectivity and stability issues without user intervention.

## v1 Requirements

### Core Telemetry Service

- [x] **TELE-01**: Abstract TelemetryService interface with recordError(), log(), setCustomKey(), setConsentEnabled()
- [x] **TELE-02**: Firebase Crashlytics TelemetryService implementation
- [x] **TELE-03**: No-op TelemetryService fallback for unsupported platforms (Linux, Windows)
- [x] **TELE-04**: Automatic crash reporting via FlutterError.onError and PlatformDispatcher.onError
- [x] **TELE-05**: Environment separation (disable telemetry in debug/simulate mode)

### Privacy & Consent

- [x] **PRIV-01**: BLE MAC address anonymization via SHA-256 hashing before any report
- [x] **PRIV-02**: IP address anonymization before any report
- [x] **PRIV-03**: Telemetry consent prompt in permissions_view.dart alongside other permissions (initially half-implemented, fixed in Phase 3 checkpoint)
- [x] **PRIV-04**: Crashlytics collection disabled until user grants consent

### Log Context

- [x] **LOGC-01**: 16kb rolling circular log buffer in memory (size enforcement fixed in Phase 3)
- [x] **LOGC-02**: Attach log buffer contents to non-fatal error reports
- [x] **LOGC-03**: System information snapshot attached to reports (device_info_plus)
- [x] **LOGC-04**: Connected device snapshot attached to reports (device types, connection states)
- [x] **LOGC-05**: BLE-specific custom keys on reports (deviceType, connectionCount; RSSI excluded per user decision)

### Error Detection

- [x] **ERRD-01**: Auto-report non-fatal errors on WARNING+ log levels via Logger.root listener
- [x] **ERRD-02**: Auto-report caught exceptions from mission-critical components
- [x] **ERRD-03**: Rate limiting — max 1 report per 60s per unique error message

### Integration

- [x] **INTG-01**: Inject TelemetryService into device discovery services
- [x] **INTG-02**: Inject TelemetryService into device transport implementations
- [~] **INTG-03**: Inject TelemetryService into API server (webserver) — covered by global Logger.root listener, not explicit injection
- [~] **INTG-04**: Inject TelemetryService into plugin service — covered by global Logger.root listener, not explicit injection
- [~] **INTG-05**: Inject TelemetryService into WebUI storage — covered by global Logger.root listener, not explicit injection

### WebView Logging

- [x] **WLOG-01**: Capture SkinView webview console output (all levels) via setOnConsoleMessage
- [x] **WLOG-02**: Write webview console logs to separate dedicated log file
- [x] **WLOG-03**: Include webview log file in existing user feedback flow

## Traceability

| Requirement | Phase | Status |
|-------------|-------|--------|
| TELE-01 | Phase 1 | Shipped |
| TELE-02 | Phase 1 | Shipped |
| TELE-03 | Phase 1 | Shipped |
| TELE-04 | Phase 1 | Shipped |
| TELE-05 | Phase 1 | Shipped |
| PRIV-01 | Phase 1 | Shipped |
| PRIV-02 | Phase 1 | Shipped |
| PRIV-03 | Phase 1+3 | Shipped (fixed in Phase 3) |
| PRIV-04 | Phase 1 | Shipped |
| LOGC-01 | Phase 1+3 | Shipped (size enforcement fixed in Phase 3) |
| LOGC-02 | Phase 2 | Shipped |
| LOGC-03 | Phase 2 | Shipped |
| LOGC-04 | Phase 2 | Shipped |
| LOGC-05 | Phase 2 | Shipped |
| ERRD-01 | Phase 2 | Shipped |
| ERRD-02 | Phase 2 | Shipped |
| ERRD-03 | Phase 2 | Shipped |
| INTG-01 | Phase 2 | Shipped |
| INTG-02 | Phase 2 | Shipped |
| INTG-03 | Phase 2 | Partial (global listener) |
| INTG-04 | Phase 2 | Partial (global listener) |
| INTG-05 | Phase 2 | Partial (global listener) |
| WLOG-01 | Phase 4 | Shipped |
| WLOG-02 | Phase 4 | Shipped |
| WLOG-03 | Phase 4 | Shipped |

## v2 Requirements (Deferred)

- **ETEL-01**: Sentry TelemetryService implementation (alternative to Firebase)
- **ETEL-02**: Manual report submission with user feedback (shake-to-report or in-app form)
- **ETEL-03**: BLE-specific error categorization with filtering in dashboard
- **ETEL-04**: Crash trend analytics and spike alerting

## Out of Scope

| Feature | Reason |
|---------|--------|
| Sentry implementation | Firebase is the first and only backend for now |
| Real-time telemetry dashboard | Reports go to Firebase console |
| Full network request logging | Security risk — captures auth tokens and API keys |
| Telemetry always-on without consent | GDPR violation |
| Sending every log line to server | Privacy nightmare, massive data usage |
| WebView logs attached to telemetry reports | Only attached to user-sent feedback, not automatic reports |

---
*Requirements defined: 2026-02-15*
*Archived: 2026-02-16 — v1.0 shipped*
